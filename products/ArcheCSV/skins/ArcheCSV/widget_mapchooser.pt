<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">
  <head><title></title></head>
  <body>


        <metal:block define-macro="view"
                        tal:define="voc field/Vocabulary;
                                    accessor python:field.getAccessor(here);
                                    value python: voc and voc.getValue(accessor()) or accessor();">
        
        </metal:block>

        <metal:block define-macro="edit">
        
            <div tal:define="headers python: here.getCSVheader();
                             arch_fields python: here.getArchFields();
                             zips python:context.getParentNode().getFolderContents(contentFilter = {'portal_type' : ['File', 'PloneExFile', 'ATFile']});">
                  <table class="listing" width="80%">
                      <th>Csv header</th>
                      <th>Archetypes "<div tal:replace="python: here.import_type" />"  fields</th>
                      
                      <th>define the zip file from which to take the value for this field</th>
                      <div tal:repeat="header headers">
                          <tr>
                              <td>
                                  <span tal:content="python: test(header,header,'empty')" />
                              </td>
                              <td>
        
                                  <div tal:condition="python:len(here.getMap_fields())==len(headers)">
                                      <select name="map_fields:list"
                                              tal:define="current_item repeat/header/index;
                                                          saved_item python:here.getMap_fields()[current_item];
                                                          arch_fields python:arch_fields">
                
                                          <option tal:attributes="selected python:test('None'==saved_item,'selected','');
                                                                  value string:None">
                                              Not used
                                          </option>
                                          <option tal:attributes="selected python:test(f.getName()==saved_item,'selected','')"
                                                  tal:repeat="f arch_fields">
                                              <div tal:replace="python:f.getName()" />
                                          </option>
                
                                      </select>
                                  </div>
                                  <div tal:condition="python:len(here.getMap_fields())!=len(headers)">
                                  
                                      <select name="map_fields:list"
                                              tal:define="current_item repeat/header/index;
                                                          arch_fields python:arch_fields">
                
                                          <option tal:attributes="value string:None">
                                              Not used
                                          </option>
                                          <!--automatically maps csv header to arch filed if same name -->
                                          <option  tal:attributes="selected python:test(f.getName()==header,'selected','')" tal:repeat="f arch_fields">
                                              <div tal:replace="python:f.getName()" />
                                          </option>
                                      </select>
                                  </div>
                             </td>
                             <td>
                                  <div tal:condition="python:len(here.getMap_zip_fields())==len(headers)">
                                  
                                      <select name="map_zip_fields:list"
                                              tal:define="current_item repeat/header/index;
                                                          saved_item python:here.getMap_zip_fields()[current_item];">
                
                                          <option tal:attributes="selected python:test('None'==saved_item,'selected','');
                                                                  value string:None">
                                              Not used
                                          </option>
                                          
                                          <tal:block tal:repeat="zip zips">
                                              <option tal:define="zipid zip/getId"
                                                      tal:attributes="selected python:test(zipid==saved_item,'selected','')">
                                                  <div tal:replace="zipid" />
                                              </option>
                                          </tal:block>
                                      </select>
                                  </div>
                                  <div tal:condition="python:len(here.getMap_zip_fields())!=len(headers)">
                                     
                                      <select name="map_zip_fields:list">
                                          <option tal:attributes="value string:None">
                                              Not used
                                          </option>
                                          <tal:block tal:repeat="zip zips">
                                              <option tal:define="zipid zip/getId">
                                                  <div tal:replace="python:zipid" />
                                              </option>
                                          </tal:block>
                                      </select>
                                  </div>
                             </td>
                         </tr>
                      </div>
                  </table>
                
            </div>

        </metal:block>
    </body>
</html>
